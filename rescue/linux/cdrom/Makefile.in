
.PATH:		.


first_rule: all
dummy:

#-------------------------------------------------------------------------

iso:
	rm -f bootcd.iso
	mkisofs -A "Bacula Rescue Disk" -V "Bacula Rescue Disk" \
	  -J -R -T -o bootcd.iso \
	  -b boot/isolinux/isolinux.bin -c boot/isolinux/boot.cat \
	  -no-emul-boot -boot-load-size 4 -boot-info-table cdtree

initrd:
	./makeinitrd

kernel:
	./makekernel

binaries:
	./makebinaries

static-bacula: dummy
	@(cd bacula; make copy-static-fd)

bacula: dummy
	@(cd bacula; make)

all:	kernel binaries bacula initrd iso

copy-static-fd: kernel binaries static-bacula initrd iso


# This needs to be customized for your burner.
burn:
	cdrecord dev=@CDSTL@ gracetime=2 fs=4096k driveropts=burnfree -v \
	 -useinfo speed=48 -dao -eject -pad -data "bootcd.iso"

blank:
	cdrecord dev=@CDSTL@ gracetime=2 -v blank=fast -useinfo speed=48

scan:
	cdrecord -scanbus

distclean:
clean:
#
# Clean out files that are rebuilt
#
	@rm -f bootcd.iso 
	@rm -f 1 2 3 4
	@rm -rf roottree/bin roottree/proc roottree/boot
	@rm -rf roottree/lib roottree/sbin roottree/dev
	@rm -rf roottree/initrd roottree/cdrom roottree/mnt
	@rm -rf roottree/tmp roottree/var	   
	@rm -f roottree/etc/services roottree/etc/exports
	@rm -f roottree/etc/gshadow roottree/etc/shadow 
	@rm -f roottree/etc/passwd  roottree/etc/group
	@rm -f roottree/etc/hosts roottree/etc/bashrc
	@rm -f roottree/etc/filesystems roottree/etc/fstab 
	@rm -f roottree/etc/protocols roottree/etc/localtime
	@rm -f roottree/etc/ld.so.cache
	@rm -f roottree/etc/modules.conf roottree/etc/syslog.conf
	@rm -rf roottree/etc/pam.d roottree/etc/ssh
	@rm -rf roottree/etc/security roottree/etc/init.d
	@rm -rf roottree/bacula-*
	@rm -f cdtree/boot/isolinux/initrd.img
	@rm -f cdtree/boot/isolinux/vmlinuz
	@rm -f cdtree/boot/isolinux/isolinux.cfg
	@rm -f cdtree/boot/isolinux/map
	@(cd bacula; make distclean)
